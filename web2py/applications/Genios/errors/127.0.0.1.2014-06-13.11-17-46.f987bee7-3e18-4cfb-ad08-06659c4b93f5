(dp1
S'output'
p2
S'<class \'gluon.contrib.pymysql.err.ProgrammingError\'> (1146, u"Table \'mydb.tb_pai_x_filho\' doesn\'t exist")'
p3
sS'layer'
p4
S'C:\\Users\\Uriel\\Desktop\\UnB\\CJR\\G\xeanios\\web2py\\applications\\Genios\\controllers/responsavel.py'
p5
sS'code'
p6
S'# coding: utf8\n# try something like\n# ENUMERATIONS\nESCREVE_FILHO = 0\nALTERA_FILHO  = 1\nDELETA_FILHO  = 2\nALTERA_RESPONSAVEL = 3\nNULLOP = 4\n\n\n#Controller da pagina inicial do Responsavel\ndef index():\n    db.tb_pai_x_filho.fk_filho.writable= False\n    form2 = SQLFORM(db.tb_pai_x_filho,fields=["fk_pai"],showid=False)\n\n    if(form2.validate()):\n        session.idpai=form2.vars.fk_pai\n        session.op = NULLOP\n        redirect(URL(\'responsavel\',\'alterar\'))\n    else:\n        session.idpai= 0\n    return dict(form=form2, session=session.idpai)\n\n\n#Controller da pagina de perfil do responsavel\ndef alterar():\n    # Session com a info do pai foi setada?\n    if not session.idpai : # Falta uma condicao aqui! if not session.op\n         redirect(URL(\'responsavel\',\'index\'))\n\n\n    #Dando um Join tb_usuario e Tb_endereco\n    #enderecopai = db(session.idpai == db.tb_endereco.fk_id_usuario).select()\n\n    #IS FORMPAI SET?\n    try:\n        formpai\n        formEndereco\n    except NameError:\n        formpai = None\n        forEndereco = None\n    \n    if formpai is None or formEndereco is None:\n        \n        #Pegando form do pai\n        formpai = SQLFORM(db.tb_usuario,session.idpai,showid=False,\n                          fields=[\'nome\',\'email\',\'senha\'],\n                          submit_button="Alterar",\n                          formstyle="divs")\n\n        #Pegando Registro do Endereco do pai\n        endereco = db.tb_endereco(db.tb_endereco.fk_id_usuario == session.idpai)\n\n        #Criando SQLFORM para alterar o Endereco\n        formEndereco = SQLFORM(db.tb_endereco,endereco,\n                               fields=[\'fk_id_cidade\',\'endereco\',\'complemento\',\'cep\'],\n                               submit_button="Alterar",\n                               formstyle="divs",\n                               showid=False)\n\n        fotopai = SQLFORM.factory(Field(\'foto\',\'upload\',default=formpai.vars.foto))\n\n        #Processa as alteracoes\n        if session.op == ALTERA_FILHO and formpai.process().accepted:\n            response.flash = "Alteracao Concluida!"\n\n\n        #SQL query INNER JOIN\n        filhosSet = db((session.idpai==db.tb_pai_x_filho.fk_pai)& (db.tb_filho.id==db.tb_pai_x_filho.fk_filho)&(db.tb_filho.ativo == True))\n\n        #Get numero de registros\n        numFilhos = filhosSet.count()\n\n        #Iniciam as Listas\n        forms = list()\n        fotos = list()\n\n        # i = 0\n        i = 0\n\n        #loop criando os formul\xc3\xa1rios referentes aos filhos\n        for filhoObj in filhosSet.select():\n            #Seta o formulario de acordo com a necessidade\n            fotos.append(filhoObj.tb_filho.foto)\n            forms.append(SQLFORM(db.tb_filho, filhoObj.tb_filho,\n                                 fields = [\'foto\',\'nome\',\'colegio\',\'ano\',\'ativo\'],\n                                 submit_button="Alterar", \n                                 showid=False,\n                                 formstyle="divs"))\n            #Incrementa o i\n            i += 1\n        #fimfor\n\n    if formpai.process().accepted:\n        response.flash = "Cadastro Pai Alterado" ;\n\n    #Get numFilhos e inicilaiza o i\n    numFilhos = i\n    i = 0\n\n    #for de processamento dos forms\n    for i in range(0,numFilhos):\n        if forms[i].process().accepted:\n            response.flash = "Cadastro Filho Alterado!"\n    #fim for\n\n\n    return dict(formpai=formpai,formEndereco = formEndereco,fotopai=fotopai,forms=forms,fotos=fotos)\n\ndef incluifilho():\n    # Testa se a session foi setada\n    if not session.idpai:\n        redirect(URL("responsavel"))\n\n    #Prepara para inserir no banco e seta a FK\n    formfilho = SQLFORM.factory(db.tb_filho,db.tb_pai_x_filho,\n                                fields=[\'nome\',\'colegio\',\'foto\'],\n                                showid=False,\n                                formstyle="divs")\n    \n    formfilho.vars.fk_pai = session.idpai\n    formfilho.vars.ativo = True\n\n    formrel = SQLFORM(db.tb_pai_x_filho)\n\n    #processa o for\n    if formfilho.process().accepted:\n        #Prepara para inserir o registro de relacionamento\n        id_filho = db.tb_filho.insert(**db.tb_filho._filter_fields(formfilho.vars))\n        response.flash = "Filho Vinculado"\n\n        #Prepopula o formulario\n        formfilho.vars.fk_pai = session.idpai\n        formfilho.vars.fk_filho = id_filho\n\n        #Insere no Banco\n        db.tb_pai_x_filho.insert(**db.tb_pai_x_filho._filter_fields(formfilho.vars))\n\n    #fim for\n\n\n    return dict(pai=session.idpai, form = formfilho, formrel = formrel)\n\n\ndef download():\n    return response.render()\n\nresponse._vars=response._caller(alterar)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/home/mdipierro/make_web2py/web2py/gluon/restricted.py", line 220, in restricted\n  File "C:\\Users\\Uriel\\Desktop\\UnB\\CJR\\G\xeanios\\web2py\\applications\\Genios\\controllers/responsavel.py", line 148, in <module>\n  File "/home/mdipierro/make_web2py/web2py/gluon/globals.py", line 385, in <lambda>\n  File "C:\\Users\\Uriel\\Desktop\\UnB\\CJR\\G\xeanios\\web2py\\applications\\Genios\\controllers/responsavel.py", line 72, in alterar\n    numFilhos = filhosSet.count()\n  File "/home/mdipierro/make_web2py/web2py/gluon/dal.py", line 10515, in count\n  File "/home/mdipierro/make_web2py/web2py/gluon/dal.py", line 1902, in count\n  File "/home/mdipierro/make_web2py/web2py/gluon/dal.py", line 1969, in execute\n  File "/home/mdipierro/make_web2py/web2py/gluon/dal.py", line 1963, in log_execute\n  File "/home/mdipierro/make_web2py/web2py/gluon/contrib/pymysql/cursors.py", line 117, in execute\n  File "/home/mdipierro/make_web2py/web2py/gluon/contrib/pymysql/connections.py", line 202, in defaulterrorhandler\nProgrammingError: (1146, u"Table \'mydb.tb_pai_x_filho\' doesn\'t exist")\n'
p11
s.